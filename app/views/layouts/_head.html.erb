<div id='head'>
<div id='rootmenu'>
<%# For the menuing system to work, we need a page %>
<%
	@page ||= Page.find_by_path("/" << controller.controller_name)
	@page ||= Page.find_by_path("/" << controller.controller_name.singularize)
%>
<%# Page changes outside of ActionController go unnoticed %>
<%# cache 'page_menu' do %>
<% Page.roots.each do |page| -%>
	<%= link_to page.menu, page.path, 
		:class => ((page == @page.try(:root))?'current':nil)  %>
<% end -%>
<%# end %>

</div><!-- id='headmenu' -->
<% if @page %>
	<div id='submenu'><div id='current_root'><%= @page.root.title %></div>
	<div id='children'>
	<% @page.root.children.each do |child| %>
	<span class='child<%=(@page==child)?" current_child":""-%>'><%= link_to child.title, child.path %></span>
	<% end %>
</div><!-- id='children'  -->
</div><!-- id='submenu'  -->
<% end %>
</div><!-- id='head'  -->
